{{ define "main" }}
<div class="container mx-auto px-4 py-8">
  <div class="max-w-5xl mx-auto">
    <!-- Header Section with Back Button and Title -->
    <div class="flex items-center mb-8">
      <a href="/"
        class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 flex items-center group transition-all duration-300">
        <svg xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-1 transform group-hover:-translate-x-1 transition-transform duration-300"
          viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
            clip-rule="evenodd" />
        </svg>
        <span class="font-medium">Back to Topics</span>
      </a>
      <div class="h-6 border-l border-gray-300 dark:border-gray-700 mx-4"></div>
      <h1 class="text-3xl font-bold text-gray-800 dark:text-primary-50">{{ .Title }}</h1>
    </div>

    <!-- Progress Card -->
    <div
      class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 transform hover:shadow-xl transition-all duration-300 border border-gray-100 dark:border-gray-700">
      <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Your Progress</h2>

      <div class="flex justify-between items-center mb-2">
        <span class="text-gray-700 dark:text-gray-300 font-medium">Progress</span>
        <span class="text-primary-600 dark:text-primary-400 font-bold" id="progress-percentage">0%</span>
      </div>
      <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-6 overflow-hidden">
        <div class="bg-primary-600 h-3 rounded-full transition-all duration-500 ease-out" id="progress-bar"
          style="width: 0%"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
          <div class="text-sm text-gray-500 dark:text-gray-400">Total Problems</div>
          <div class="text-2xl font-bold text-gray-800 dark:text-white mt-1" id="total-problems">{{ if .Params.problems
            }}{{ len .Params.problems }}{{ else }}0{{ end }}</div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
          <div class="text-sm text-gray-500 dark:text-gray-400">Completed</div>
          <div class="text-2xl font-bold text-green-500 dark:text-green-400 mt-1" id="completed-problems">0</div>
        </div>
        <div class="flex justify-center">
          <button id="pick-random"
            class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-6 rounded-lg text-center transition duration-300 flex items-center shadow-md hover:shadow-lg transform hover:-translate-y-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                clip-rule="evenodd" />
            </svg>
            Pick Random Problem
          </button>
        </div>
      </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="mb-6 flex flex-col md:flex-row gap-4">
      <div class="relative flex-grow">
        <input type="text" id="search-input" placeholder="Search problems or notes..."
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:text-white pl-10">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
              clip-rule="evenodd" />
          </svg>
        </div>
      </div>
      <div class="flex gap-2">
        <button id="filter-all"
          class="filter-button active px-4 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-lg font-medium transition-all duration-200">All</button>
        <button id="filter-todo"
          class="filter-button px-4 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-lg font-medium transition-all duration-200">To
          Do</button>
        <button id="filter-done"
          class="filter-button px-4 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-lg font-medium transition-all duration-200">Done</button>
        <button id="filter-bookmarked"
          class="filter-button px-4 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-lg font-medium transition-all duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Problem List -->
    {{ if .Params.problems }}
    <div
      class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-100 dark:border-gray-700">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-gray-900">
            <tr>
              <th scope="col"
                class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Status</th>
              <th scope="col"
                class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Problem</th>
              <th scope="col"
                class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Bookmark</th>
              <th scope="col"
                class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Notes</th>
              <th scope="col"
                class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="problems-table">
            {{ range $index, $problem := .Params.problems }}
            <tr data-index="{{ $index }}" data-title="{{ $problem.title }}"
              class="hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="problem-checkbox sr-only" data-problem-id="{{ $index }}">
                    <div
                      class="checkbox-toggle w-5 h-5 border-2 border-gray-300 dark:border-gray-600 rounded flex items-center justify-center transition-all duration-200">
                      <svg class="w-3 h-3 text-white opacity-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd" />
                      </svg>
                    </div>
                  </label>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm font-medium text-gray-900 dark:text-white problem-title">{{ $problem.title }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <button
                  class="bookmark-button focus:outline-none transform transition-transform duration-200 hover:scale-110"
                  data-problem-id="{{ $index }}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z" />
                  </svg>
                </button>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <button
                  class="notes-button focus:outline-none transform transition-transform duration-200 hover:scale-110"
                  data-problem-id="{{ $index }}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                    <path fill-rule="evenodd"
                      d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
                      clip-rule="evenodd" />
                  </svg>
                </button>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex space-x-2">
                  <a href="{{ $problem.url }}" target="_blank"
                    class="inline-flex items-center px-3 py-1 rounded-md bg-primary-50 text-primary-700 hover:bg-primary-100 dark:bg-primary-900/20 dark:text-primary-400 dark:hover:bg-primary-900/40 transition-colors duration-200">
                    <span class="text-xs font-medium">GFG</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-1" viewBox="0 0 20 20"
                      fill="currentColor">
                      <path
                        d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                      <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                    </svg>
                  </a>
                  {{ if $problem.url2 }}
                  <a href="{{ $problem.url2 }}" target="_blank"
                    class="inline-flex items-center px-3 py-1 rounded-md bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/40 transition-colors duration-200">
                    <span class="text-xs font-medium">CN</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-1" viewBox="0 0 20 20"
                      fill="currentColor">
                      <path
                        d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                      <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                    </svg>
                  </a>
                  {{ end }}
                </div>
              </td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </div>
    {{ else }}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-12 text-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none"
        viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <p class="text-gray-700 dark:text-gray-300 text-lg">No problems found for this topic.</p>
      <a href="/"
        class="mt-4 inline-block bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded text-center transition duration-300">Return
        to Topics</a>
    </div>
    {{ end }}

    <!-- Notes Modal -->
    <div id="notes-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden backdrop-blur-sm">
      <div
        class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full mx-4 transform transition-all opacity-0 scale-95"
        id="modal-content">
        <div class="p-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white" id="notes-modal-title">Problem Notes</h3>
          <button id="notes-close"
            class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        <div class="p-5">
          <textarea id="notes-content"
            class="w-full h-48 px-3 py-2 text-gray-700 dark:text-white border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 resize-none"
            placeholder="Add your notes here..."></textarea>
        </div>
        <div class="p-5 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
          <button id="notes-cancel"
            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-lg transition-colors">Cancel</button>
          <button id="notes-save"
            class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd" />
            </svg>
            Save Notes
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Get the current topic slug from the URL
    const pathParts = window.location.pathname.split('/').filter(Boolean);
    const topicSlug = pathParts[0];

    // Initialize problem data storage
    let problemsData = [];
    const totalProblems = parseInt(document.getElementById('total-problems').textContent);
    let currentFilter = 'all';

    // Load saved data from localStorage
    function loadSavedData() {
      // Create a key for this topic
      const storageKey = `topic-${topicSlug}`;

      // Try to load existing data
      try {
        const savedData = localStorage.getItem(storageKey);
        if (savedData) {
          problemsData = JSON.parse(savedData);
          // Make sure all problems have required properties
          problemsData = problemsData.map((problem, index) => ({
            id: index,
            done: problem.done || false,
            bookmark: problem.bookmark || false,
            notes: problem.notes || ''
          }));
        } else {
          // Initialize with default data
          problemsData = Array(totalProblems).fill().map((_, index) => ({
            id: index,
            done: false,
            bookmark: false,
            notes: ''
          }));
          // Save to localStorage
          localStorage.setItem(storageKey, JSON.stringify(problemsData));
        }

        // Store the total problems count
        localStorage.setItem(`${topicSlug}-total-problems`, totalProblems.toString());

        // Update UI based on loaded data
        updateUI();
      } catch (error) {
        console.error('Error loading saved data:', error);
        // Initialize with empty data on error
        problemsData = Array(totalProblems).fill().map((_, index) => ({
          id: index,
          done: false,
          bookmark: false,
          notes: ''
        }));
      }
    }

    // Update UI based on current data
    function updateUI() {
      // Count completed problems
      const completedCount = problemsData.filter(problem => problem.done).length;

      // Update progress indicators
      const percentage = Math.round((completedCount / totalProblems) * 100);
      document.getElementById('progress-percentage').textContent = `${percentage}%`;
      document.getElementById('progress-bar').style.width = `${percentage}%`;
      document.getElementById('completed-problems').textContent = completedCount;

      // Update checkboxes and bookmarks
      problemsData.forEach(problem => {
        const checkbox = document.querySelector(`.problem-checkbox[data-problem-id="${problem.id}"]`);
        if (checkbox) {
          checkbox.checked = problem.done;
          const toggle = checkbox.nextElementSibling;
          if (problem.done) {
            toggle.classList.add('bg-primary-600');
            toggle.classList.remove('border-gray-300', 'dark:border-gray-600');
            toggle.querySelector('svg').classList.remove('opacity-0');

            // Add strikethrough to completed problems
            const row = checkbox.closest('tr');
            const titleEl = row.querySelector('.problem-title');
            titleEl.classList.add('line-through', 'text-gray-400', 'dark:text-gray-500');
          } else {
            toggle.classList.remove('bg-primary-600');
            toggle.classList.add('border-gray-300', 'dark:border-gray-600');
            toggle.querySelector('svg').classList.add('opacity-0');

            // Remove strikethrough
            const row = checkbox.closest('tr');
            const titleEl = row.querySelector('.problem-title');
            titleEl.classList.remove('line-through', 'text-gray-400', 'dark:text-gray-500');
          }
        }

        const bookmarkButton = document.querySelector(`.bookmark-button[data-problem-id="${problem.id}"]`);
        if (bookmarkButton) {
          const svgIcon = bookmarkButton.querySelector('svg');
          if (problem.bookmark) {
            svgIcon.classList.add('text-yellow-500');
            svgIcon.classList.remove('text-gray-400');
          } else {
            svgIcon.classList.add('text-gray-400');
            svgIcon.classList.remove('text-yellow-500');
          }
        }

        // Check for notes indicator
        const notesButton = document.querySelector(`.notes-button[data-problem-id="${problem.id}"]`);
        if (notesButton) {
          const svgIcon = notesButton.querySelector('svg');
          if (problem.notes && problem.notes.trim() !== '') {
            svgIcon.classList.add('text-primary-500');
            svgIcon.classList.remove('text-gray-400');
          } else {
            svgIcon.classList.add('text-gray-400');
            svgIcon.classList.remove('text-primary-500');
          }
        }
      });

      // Apply filters
      applyFilters();
    }

    // Save data to localStorage
    function saveData() {
      const storageKey = `topic-${topicSlug}`;
      localStorage.setItem(storageKey, JSON.stringify(problemsData));
      updateUI();
    }

    // Handle checkbox changes
    document.querySelectorAll('.problem-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', function () {
        const problemId = parseInt(this.dataset.problemId);
        const problem = problemsData.find(p => p.id === problemId);

        if (problem) {
          problem.done = this.checked;
          saveData();

          // Show brief notification
          showNotification(problem.done ? "Problem marked as done!" : "Problem marked as not done");
        }
      });
    });

    // Handle bookmark clicks
    document.querySelectorAll('.bookmark-button').forEach(button => {
      button.addEventListener('click', function () {
        const problemId = parseInt(this.dataset.problemId);
        const problem = problemsData.find(p => p.id === problemId);

        if (problem) {
          problem.bookmark = !problem.bookmark;
          saveData();

          // Show brief notification
          showNotification(problem.bookmark ? "Problem bookmarked!" : "Bookmark removed");
        }
      });
    });

    // Notes modal functionality
    const notesModal = document.getElementById('notes-modal');
    const modalContent = document.getElementById('modal-content');
    const notesModalTitle = document.getElementById('notes-modal-title');
    const notesContent = document.getElementById('notes-content');
    const notesSaveBtn = document.getElementById('notes-save');
    const notesCancelBtn = document.getElementById('notes-cancel');
    const notesCloseBtn = document.getElementById('notes-close');
    let currentProblemId = null;

    // Open notes modal
    document.querySelectorAll('.notes-button').forEach(button => {
      button.addEventListener('click', function () {
        currentProblemId = parseInt(this.dataset.problemId);
        const problem = problemsData.find(p => p.id === currentProblemId);
        const problemTitle = document.querySelector(`tr[data-index="${currentProblemId}"]`).dataset.title;

        notesModalTitle.textContent = `Notes: ${problemTitle}`;
        notesContent.value = problem ? problem.notes || '' : '';

        notesModal.classList.remove('hidden');
        setTimeout(() => {
          modalContent.classList.remove('opacity-0', 'scale-95');
          modalContent.classList.add('opacity-100', 'scale-100');
        }, 10);

        notesContent.focus();
      });
    });

    // Close notes modal
    function closeNotesModal() {
      modalContent.classList.remove('opacity-100', 'scale-100');
      modalContent.classList.add('opacity-0', 'scale-95');

      setTimeout(() => {
        notesModal.classList.add('hidden');
        currentProblemId = null;
      }, 300);
    }

    notesCancelBtn.addEventListener('click', closeNotesModal);
    notesCloseBtn.addEventListener('click', closeNotesModal);

    // Close modal when clicking on backdrop
    notesModal.addEventListener('click', function (e) {
      if (e.target === notesModal) {
        closeNotesModal();
      }
    });

    // Save notes
    notesSaveBtn.addEventListener('click', function () {
      if (currentProblemId !== null) {
        const problem = problemsData.find(p => p.id === currentProblemId);
        if (problem) {
          const oldNotesEmpty = !problem.notes || problem.notes.trim() === '';
          problem.notes = notesContent.value;
          saveData();

          if (problem.notes && problem.notes.trim() !== '' && oldNotesEmpty) {
            showNotification("Notes added!");
          } else if (problem.notes && problem.notes.trim() !== '') {
            showNotification("Notes updated!");
          } else {
            showNotification("Notes cleared");
          }
        }
        closeNotesModal();
      }
    });

    // Search functionality
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', function () {
      applyFilters();
    });

    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-button');

    filterButtons.forEach(button => {
      button.addEventListener('click', function () {
        // Remove active class from all buttons
        filterButtons.forEach(btn => btn.classList.remove('active', 'bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-700', 'dark:text-primary-400'));

        // Add active class to clicked button
        this.classList.add('active', 'bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-700', 'dark:text-primary-400');

        // Set current filter based on button id
        currentFilter = this.id.replace('filter-', '');

        // Apply filters
        applyFilters();
      });
    });

    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase();
      const rows = document.querySelectorAll('#problems-table tr');

      rows.forEach(row => {
        const problemId = parseInt(row.dataset.index);
        const problem = problemsData.find(p => p.id === problemId);

        if (!problem) return;

        const title = row.dataset.title.toLowerCase();
        const notes = problem ? (problem.notes || '').toLowerCase() : '';

        // Filter by search term
        const matchesSearch = title.includes(searchTerm) || notes.includes(searchTerm);

        // Filter by status
        let matchesFilter = true;
        if (currentFilter === 'todo') {
          matchesFilter = !problem.done;
        } else if (currentFilter === 'done') {
          matchesFilter = problem.done;
        } else if (currentFilter === 'bookmarked') {
          matchesFilter = problem.bookmark;
        }

        // Show or hide based on combined filters
        if (matchesSearch && matchesFilter) {
          row.classList.remove('hidden');
        } else {
          row.classList.add('hidden');
        }
      });
    }

    // Pick random problem
    const pickRandomBtn = document.getElementById('pick-random');
    pickRandomBtn.addEventListener('click', function () {
      const visibleRows = Array.from(document.querySelectorAll('#problems-table tr:not(.hidden)'));

      if (visibleRows.length > 0) {
        // Remove any existing highlights
        document.querySelectorAll('.highlighted-row').forEach(row => {
          row.classList.remove('highlighted-row', 'bg-yellow-50', 'dark:bg-yellow-900/30');
        });

        // Pick a random row
        const randomIndex = Math.floor(Math.random() * visibleRows.length);
        const randomRow = visibleRows[randomIndex];

        // Highlight the row
        randomRow.classList.add('highlighted-row', 'bg-yellow-50', 'dark:bg-yellow-900/30');

        // Add subtle animation
        randomRow.classList.add('animate-pulse');
        setTimeout(() => {
          randomRow.classList.remove('animate-pulse');
        }, 1500);

        // Scroll to the row
        randomRow.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Show notification
        const problemTitle = randomRow.dataset.title;
        showNotification(`Selected: ${problemTitle}`);
      } else {
        showNotification("No matching problems found!");
      }
    });

    // Toast notification system
    function showNotification(message) {
      // Remove any existing notifications
      const existingNotifications = document.querySelectorAll('.notification-toast');
      existingNotifications.forEach(toast => {
        toast.remove();
      });

      // Create new notification
      const notification = document.createElement('div');
      notification.className = 'notification-toast fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-y-10 opacity-0 transition-all duration-300';
      notification.innerHTML = message;

      document.body.appendChild(notification);

      // Show notification with animation
      setTimeout(() => {
        notification.classList.remove('translate-y-10', 'opacity-0');
      }, 10);

      // Hide after 3 seconds
      setTimeout(() => {
        notification.classList.add('translate-y-10', 'opacity-0');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 3000);
    }

    // Add keyboard shortcuts
    document.addEventListener('keydown', function (e) {
      // Escape to close modal
      if (e.key === 'Escape' && !notesModal.classList.contains('hidden')) {
        closeNotesModal();
      }

      // Ctrl+/ to focus search
      if (e.key === '/' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        searchInput.focus();
      }

      // R to pick random problem
      if (e.key === 'r' && !e.ctrlKey && !e.metaKey &&
        !notesModal.classList.contains('hidden') &&
        document.activeElement !== searchInput &&
        document.activeElement !== notesContent) {
        pickRandomBtn.click();
      }
    });

    // Dark mode toggle (optional, can be implemented elsewhere in the Hugo template)
    const addDarkModeToggle = () => {
      const header = document.querySelector('.container');
      if (!header) return;

      const darkModeToggle = document.createElement('button');
      darkModeToggle.className = 'absolute top-4 right-4 p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors';
      darkModeToggle.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-800 dark:text-gray-200" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
      </svg>
    `;

      darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('darkMode', document.documentElement.classList.contains('dark') ? 'true' : 'false');
      });

      header.style.position = 'relative';
      header.appendChild(darkModeToggle);
    };

    // Initialize dark mode from localStorage
    const initDarkMode = () => {
      if (localStorage.getItem('darkMode') === 'true' ||
        (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    };

    // Statistics feature
    const addStatsDashboard = () => {
      // Create a stats button
      const progressCard = document.querySelector('.progress-card');
      if (!progressCard) return;

      const statsButton = document.createElement('button');
      statsButton.className = 'ml-2 text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 focus:outline-none';
      statsButton.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
      </svg>
    `;

      // Add click event to show stats modal
      statsButton.addEventListener('click', () => {
        // Could implement a statistics modal here
        showNotification("Statistics feature coming soon!");
      });
    };

    // Export/import data functionality
    const setupDataManagement = () => {
      // Could be implemented to add data backup/restore functionality
    };

    // Setup keyboard shortcut hints
    const setupKeyboardShortcuts = () => {
      const footer = document.createElement('div');
      footer.className = 'mt-8 text-center text-xs text-gray-500 dark:text-gray-400';
      footer.innerHTML = `
      <p>Keyboard shortcuts: <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded">r</kbd> Pick random problem, 
      <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded">Ctrl+/</kbd> Focus search,
      <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded">Esc</kbd> Close dialog</p>
    `;

      document.querySelector('.container > div').appendChild(footer);
    };

    // Set active filter button initially
    document.getElementById('filter-all').classList.add('active', 'bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-700', 'dark:text-primary-400');

    // Initialize
    loadSavedData();
    // initDarkMode();
    // Uncomment to enable these features:
    // addDarkModeToggle();
    // setupKeyboardShortcuts();
  });
</script>

<style>
  /* Custom animation */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .highlighted-row {
    position: relative;
  }

  .highlighted-row::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background-color: #f59e0b;
  }

  /* Custom checkbox styling */
  .checkbox-toggle.bg-primary-600 {
    border-color: transparent;
  }

  /* Active filter button highlighting */
  .filter-button.active {
    font-weight: 500;
  }

  /* Improved focus styles */
  *:focus-visible {
    outline: 2px solid rgb(79, 70, 229);
    outline-offset: 2px;
  }

  /* Smooth transitions */
  .problem-title {
    transition: all 0.2s ease;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(229, 231, 235, 0.5);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.5);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(107, 114, 128, 0.5);
  }

  .dark ::-webkit-scrollbar-track {
    background: rgba(55, 65, 81, 0.5);
  }

  .dark ::-webkit-scrollbar-thumb {
    background: rgba(75, 85, 99, 0.5);
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background: rgba(107, 114, 128, 0.5);
  }

  /* Modal animation */
  #modal-content {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
</style>
{{ end }}