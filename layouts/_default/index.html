{{ define "main" }}
<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold text-center text-gray-800 dark:text-white mb-8">450 DSA Cracker</h1>
  
  <div class="max-w-3xl mx-auto mb-8 text-center">
    <p class="text-lg text-gray-700 dark:text-gray-300">
      A comprehensive collection of 450 DSA problems to help you ace your coding interviews.
      Track your progress, practice systematically, and build your confidence.
    </p>
  </div>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {{ range $index, $topic := slice "Array" "Matrix" "String" "Searching & Sorting" "Linked List" "Binary Trees" "Binary Search Trees" "Greedy" "Backtracking" "Stacks & Queues" "Heap" "Graph" "Trie" "Dynamic Programming" "Bit Manipulation" }}
    {{ $slug := $topic | lower | replaceRE "[^a-z0-9]+" "-" }}
    {{ if eq $topic "Binary Search Trees" }}{{ $slug = "bst" }}{{ end }}
    {{ if eq $topic "Searching & Sorting" }}{{ $slug = "searching-sorting" }}{{ end }}
    {{ if eq $topic "Stacks & Queues" }}{{ $slug = "stacks-queues" }}{{ end }}
    {{ if eq $topic "Linked List" }}{{ $slug = "linked-list" }}{{ end }}
    {{ if eq $topic "Binary Trees" }}{{ $slug = "binary-trees" }}{{ end }}
    {{ if eq $topic "Dynamic Programming" }}{{ $slug = "dynamic-programming" }}{{ end }}
    {{ if eq $topic "Bit Manipulation" }}{{ $slug = "bit-manipulation" }}{{ end }}
    <div class="card hover:shadow-lg transition-shadow duration-300" data-topic-slug="{{ $slug }}">
      <div class="card-header">
        <h2 class="text-xl font-semibold text-white">{{ $topic }}</h2>
      </div>
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <span class="text-gray-700 dark:text-gray-300">Progress</span>
          <span class="text-primary-600 dark:text-primary-400 font-medium" id="progress-{{ $slug }}">0%</span>
        </div>
        <div class="progress-bar mb-6">
          <div class="progress-bar-fill" id="progress-bar-{{ $slug }}" style="width: 0%"></div>
        </div>
        <div class="mt-6">
          <a href="/{{ $slug }}/" class="btn btn-primary w-full text-center">
            Start Practice
          </a>
        </div>
      </div>
    </div>
    {{ end }}
  </div>
</div>

<!-- Topic problem counts -->
<script type="application/json" id="topic-problem-counts">
{
  "array": 36,
  "matrix": 10,
  "string": 43,
  "searching-sorting": 36,
  "linked-list": 36,
  "binary-trees": 35,
  "bst": 22,
  "greedy": 35,
  "backtracking": 19,
  "stacks-queues": 38,
  "heap": 18,
  "graph": 44,
  "trie": 6,
  "dynamic-programming": 60,
  "bit-manipulation": 10
}
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get problem counts from embedded JSON
  let topicProblemCounts = {};
  try {
    const problemCountsJson = document.getElementById('topic-problem-counts').textContent;
    topicProblemCounts = JSON.parse(problemCountsJson);
  } catch (error) {
    console.error('Error parsing problem counts:', error);
    // Fallback counts if JSON parsing fails
    topicProblemCounts = {
      'array': 36,
      'matrix': 10,
      'string': 43,
      'searching-sorting': 36,
      'linked-list': 36,
      'binary-trees': 35,
      'bst': 22,
      'greedy': 35,
      'backtracking': 19,
      'stacks-queues': 38,
      'heap': 18,
      'graph': 44,
      'trie': 6,
      'dynamic-programming': 60,
      'bit-manipulation': 10
    };
  }
  
  // Define topic slugs
  const topicSlugs = {
    'array': 'Array',
    'matrix': 'Matrix',
    'string': 'String',
    'searching-sorting': 'Searching & Sorting',
    'linked-list': 'Linked List',
    'binary-trees': 'Binary Trees',
    'bst': 'Binary Search Trees',
    'greedy': 'Greedy',
    'backtracking': 'Backtracking',
    'stacks-queues': 'Stacks & Queues',
    'heap': 'Heap',
    'graph': 'Graph',
    'trie': 'Trie',
    'dynamic-programming': 'Dynamic Programming',
    'bit-manipulation': 'Bit Manipulation'
  };
  
  // Update progress for each topic
  Object.keys(topicSlugs).forEach(slug => {
    // Get the total number of problems for this topic
    const totalProblems = topicProblemCounts[slug] || 30;
    
    // Store the total problems count in localStorage
    localStorage.setItem(`${slug}-total-problems`, totalProblems.toString());
    
    // Get or initialize progress data
    let progressData = [];
    try {
      const savedData = localStorage.getItem(`topic-${slug}`);
      if (savedData) {
        progressData = JSON.parse(savedData);
      } else {
        // Initialize with default data
        progressData = Array(totalProblems).fill().map((_, index) => ({
          id: index,
          done: false,
          bookmark: false,
          notes: ''
        }));
        // Save to localStorage
        localStorage.setItem(`topic-${slug}`, JSON.stringify(progressData));
      }
    } catch (error) {
      console.error(`Error loading saved data for ${slug}:`, error);
      progressData = [];
    }
    
    // Count completed problems
    const completedCount = progressData.filter(problem => problem.done).length;
    
    // Update UI
    const progressElement = document.getElementById(`progress-${slug}`);
    const progressBarElement = document.getElementById(`progress-bar-${slug}`);
    
    if (progressElement && progressBarElement) {
      const percentage = Math.round((completedCount / totalProblems) * 100);
      
      progressElement.textContent = `${percentage}%`;
      progressBarElement.style.width = `${percentage}%`;
    }
  });
});
</script>
{{ end }}
