{{ define "main" }}
<div class="container mx-auto px-4 py-8">
  <div class="max-w-5xl mx-auto">
    <div class="flex items-center mb-6">
      <a href="/" class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 mr-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>
      </a>
      <h1 class="text-3xl font-bold text-gray-800 dark:text-white">{{ .Title }}</h1>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
      <div class="flex justify-between items-center mb-4">
        <span class="text-gray-700 dark:text-gray-300">Progress</span>
        <span class="text-primary-600 dark:text-primary-400 font-medium">0%</span>
      </div>
      <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-6">
        <div class="bg-primary-600 h-2.5 rounded-full" style="width: 0%"></div>
      </div>
      
      <div class="flex justify-between items-center">
        <div>
          <span class="text-gray-700 dark:text-gray-300">Total Problems:</span>
          <span class="ml-2 font-medium">{{ len .Params.problems }}</span>
        </div>
        <div>
          <span class="text-gray-700 dark:text-gray-300">Completed:</span>
          <span class="ml-2 font-medium">0</span>
        </div>
      </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-gray-900">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Problem</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {{ range $index, $problem := .Params.problems }}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <input type="checkbox" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" data-problem-id="{{ $index }}">
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm font-medium text-gray-900 dark:text-white">{{ $problem.title }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <a href="{{ $problem.url }}" target="_blank" class="text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300">Solve</a>
              </td>
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  // Initialize problem tracking
  document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const progressBar = document.querySelector('.bg-primary-600.h-2.5');
    const progressText = document.querySelector('.text-primary-600.dark\\:text-primary-400.font-medium');
    const completedText = document.querySelector('span.ml-2.font-medium:last-of-type');
    
    // Load saved progress from localStorage
    const topicId = '{{ .File.ContentBaseName }}';
    const savedProgress = JSON.parse(localStorage.getItem(`topic-${topicId}`) || '[]');
    
    // Update UI with saved progress
    let completed = 0;
    checkboxes.forEach((checkbox, index) => {
      if (savedProgress.includes(index)) {
        checkbox.checked = true;
        completed++;
      }
      
      // Add event listener to update progress
      checkbox.addEventListener('change', function() {
        const problemId = parseInt(this.dataset.problemId);
        const isChecked = this.checked;
        
        // Update saved progress
        const currentProgress = JSON.parse(localStorage.getItem(`topic-${topicId}`) || '[]');
        if (isChecked && !currentProgress.includes(problemId)) {
          currentProgress.push(problemId);
          completed++;
        } else if (!isChecked && currentProgress.includes(problemId)) {
          const idx = currentProgress.indexOf(problemId);
          currentProgress.splice(idx, 1);
          completed--;
        }
        
        localStorage.setItem(`topic-${topicId}`, JSON.stringify(currentProgress));
        
        // Update UI
        const percentage = Math.round((completed / checkboxes.length) * 100);
        progressBar.style.width = `${percentage}%`;
        progressText.textContent = `${percentage}%`;
        completedText.textContent = completed;
      });
    });
    
    // Initial UI update
    const percentage = Math.round((completed / checkboxes.length) * 100);
    progressBar.style.width = `${percentage}%`;
    progressText.textContent = `${percentage}%`;
    completedText.textContent = completed;
  });
</script>
{{ end }}
